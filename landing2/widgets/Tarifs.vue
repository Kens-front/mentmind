<template>
    <div>  
        <div class="tarifs wrap">
            <h3 class="title">–¢–∞—Ä–∏—Ñ—ã</h3>  

            <div class="content">
                <TarifCard v-for="value in cards" :key="value.title" :tarif="value"/>
            </div>
 
        </div>

        <div class="tarifs-mobile">
            <TarifSlider :slider="cards"/>
        </div>
    </div>
</template>

<script setup lang="ts">
import { gsap } from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'
import { nextTick, onMounted, ref } from 'vue';
import TarifCard from '~/components/TarifCard.vue';
import TarifSlider from '../widgets/TarifSlider.vue'
gsap.registerPlugin(ScrollTrigger)

const prices = ref({
    group: 2400,
    base: 3600,
    top: 4500,
})

const discounts = ref({
    group: 2400,
    base: 3600,
    top: 4500,
})

const group = ref(2400)
 const  base = ref( 3600)
const top = ref(4500)


onMounted(async () => {
    await nextTick();
    const contents = document.querySelectorAll('.tarifs');
    const cards = document.querySelectorAll('.tarifs .tarif')
    const lines = gsap.utils.toArray('.line')
    // –°–æ–∑–¥–∞–µ–º —Ç–∞–π–º–ª–∞–π–Ω —Å ScrollTrigger
    const tl = gsap.timeline({
        scrollTrigger: {
            trigger: '.tarifs',
            start: 'top top', // –ù–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –≤–µ—Ä—Ö —Å–µ–∫—Ü–∏–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –≤–µ—Ä—Ö–∞ –æ–∫–Ω–∞
            end: '+=800', // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã)
            scrub: 1, // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å–∫—Ä–æ–ª–ª—É
            pin: true, // –ó–∞–∫—Ä–µ–ø–ª—è–µ–º —Å–µ–∫—Ü–∏—é
            anticipatePin: 1, // –£–ª—É—á—à–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è
        },
    });


    tl.to(group, {
        value: 1600,
        snap: { value: 1 },
    }, '<')
    tl.to(base, {
        value: 2200,
        snap: { value: 1 },
    }, '<')

    tl.to(top, {
    value: 4000,
    snap: { value: 1 },
    }, '<')
    tl.to(lines, {
        width: '100%',
    }, '<')



    const t2 = gsap.timeline({
        scrollTrigger: {
            trigger: '.tarifs-mobile',
            start: 'top top', // –ù–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –≤–µ—Ä—Ö —Å–µ–∫—Ü–∏–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –≤–µ—Ä—Ö–∞ –æ–∫–Ω–∞
            end: '+=800', // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã)
            scrub: 1, // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å–∫—Ä–æ–ª–ª—É
            pin: true, // –ó–∞–∫—Ä–µ–ø–ª—è–µ–º —Å–µ–∫—Ü–∏—é
            anticipatePin: 1, // –£–ª—É—á—à–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è
        },
    });


    t2.to(group, {
        value: 1800,
        snap: { value: 1 },
    }, '<')
    t2.to(base, {
        value: 2600,
        snap: { value: 1 },
    }, '<')

    t2.to(top, {
    value: 3600,
    snap: { value: 1 },
    }, '<')
    t2.to(lines, {
        width: '100%',
    }, '<')
 
});

const cards = computed(() => [
  {
    percent: Math.ceil(100 - 1800 / 2400 * 100),
    title: '–ì—Ä—É–ø–ø–æ–≤–æ–π',
    oldPrice: 2400,
    newPrice: group.value,
    features: [
      '–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
      '–ó–∞–Ω—è—Ç–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –æ–ø—ã—Ç–Ω—ã–º –º–µ–Ω—Ç–æ—Ä–æ–º',
      '–ù–µ–±–æ–ª—å—à–∏–µ –≥—Ä—É–ø–ø—ã ‚Äî –¥–æ 2 —á–µ–ª–æ–≤–µ–∫',
      '–ñ–∏–≤–æ–µ –æ–±—â–µ–Ω–∏–µ –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞',
      '–í—ã–≥–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏',
    ],
  },
  {
    percent: Math.ceil(100 - 2200 / 3600 * 100),
    title: '–ë–∞–∑–æ–≤—ã–π',
    oldPrice: 3600,
    newPrice: base.value,
    features: [
      '–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
      '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –º–µ–Ω—Ç–æ—Ä–æ–º',
      '–ì–∏–±–∫–∏–π —Ç–µ–º–ø –æ–±—É—á–µ–Ω–∏—è –ø–æ–¥ –≤–∞—à–∏ —Ü–µ–ª–∏',
      '–ì–ª—É–±–æ–∫–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å',
      'üéÅ –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Ç 10 –∑–∞–Ω—è—Ç–∏–π ‚Äî 1 —Å–µ—Å—Å–∏—è —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º-–∫–æ—É—á–µ–º',
    ],
  },
  {
    percent: Math.ceil(100 - 4000 / 4500 * 100),
    title: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
    oldPrice: 4500,
    newPrice: top.value,
    features: [
      '–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
      '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è —Å –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–º –º–µ–Ω—Ç–æ—Ä–æ–º',
      '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å—É',
      '–†–∞–±–æ—Ç–∞ —Å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º–∏ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏',
      'üéÅ –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Ç 10 –∑–∞–Ω—è—Ç–∏–π ‚Äî 2 —Å–µ—Å—Å–∏–∏ —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º-–∫–æ—É—á–µ–º',
    ],
  },
])
</script>

<style lang="scss" scoped>
.tarifs {
    display: grid;
    grid-template-columns: 100%;
    grid-template-rows: max-content 1fr;
    align-items: center;
    justify-content: center;
    padding: 5rem 10rem;
    row-gap: 2.4rem;
    background: url('../public/assets/noise.png');
    &-mobile {
        display: none;

        @media screen and (max-width: 1024px) {
            display: block;
        }
    }
}

.content {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(10rem, 1fr));
    height: 100%;
    column-gap: 4rem;
}

.wrap {
    @media screen and (max-width: 1024px) {
        display: none;
    }
}
</style>